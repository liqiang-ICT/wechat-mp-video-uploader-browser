(()=>{var e={896:e=>{"use strict";e.exports=require("fs")},928:e=>{"use strict";e.exports=require("path")},938:e=>{"use strict";e.exports=require("axios")},952:(e,s,t)=>{e=t.nmd(e);const n=t(896),o=t(928),r=t(982),c=t(938),i={manifestUrl:"https://cdn.jsdelivr.net/gh/liqiang-ICT/wechat-mp-video-uploader-browser@latest/update-manifest.json",watchDirs:["dist"],ignoreFiles:[".DS_Store","user-data/*","*.log","*.bat","accounts-data.json"]};const a=function(){try{const e=o.resolve("update-config.json");if(n.existsSync(e)){const s=JSON.parse(n.readFileSync(e,"utf-8"));return{...i,...s}}}catch(e){console.warn("加载 update-config.json 失败:",e.message)}return i}();function l(e){return r.createHash("sha256").update(e).digest("hex")}function u(){const e={version:Date.now(),files:{}};return a.watchDirs.forEach(s=>{const t=function(e){const s=[];if(!n.existsSync(e))return s;const t=e=>{const r=n.readdirSync(e,{withFileTypes:!0});for(const n of r){const r=o.join(e,n.name);n.isDirectory()?t(r):a.ignoreFiles.includes(n.name)||s.push(r)}};return t(e),s}(s);for(const s of t){const t=s.replace(/\\/g,"/"),o=n.readFileSync(s);e.files[t]={hash:l(o),size:o.length}}}),e}async function f(){try{if(!a.manifestUrl||!a.manifestUrl.includes("update-manifest.json"))return console.error("manifestUrl 未配置或格式不正确，请使用命令：node update-manager.js set-url <清单地址>"),[];console.log("正在从远程清单检查更新...");const{data:e}=await c.get(a.manifestUrl,{timeout:15e3}),s=u(),t=a.manifestUrl.replace(/update-manifest\.json$/,""),n=[];for(const[o,r]of Object.entries(e.files||{})){const e=s.files[o];e&&e.hash===r.hash||n.push({file:o,url:`${t}${o}`,hash:r.hash,size:r.size})}return n}catch(e){return console.error("检查更新失败:",e.message),[]}}async function d(){const e=await f();if(!e.length)return console.log("当前已是最新版本");console.log(`发现 ${e.length} 个待更新文件：`);for(const{file:s,url:t,hash:r}of e)try{console.log(`下载: ${t}`);const e=await c.get(t,{responseType:"arraybuffer",timeout:3e4}),i=Buffer.from(e.data),a=l(i);if(r&&a!==r){console.error(`校验失败: ${s}（期望 ${r}，实际 ${a}），已跳过`);continue}const u=o.dirname(s);n.existsSync(u)||n.mkdirSync(u,{recursive:!0}),n.writeFileSync(s,i),console.log(`✓ 已更新: ${s}`)}catch(e){console.error(`更新失败: ${s} -> ${e.message}`)}console.log("更新流程完成")}function g(e){if(!e||!e.startsWith("https://"))return void console.error("无效的 URL，请提供 https 地址");const s=o.resolve("update-config.json"),t={...a,manifestUrl:e};n.writeFileSync(s,JSON.stringify(t,null,2)),console.log("已写入 update-config.json")}function h(){console.log("当前更新配置:"),console.log(JSON.stringify(a,null,2))}if(t.c[t.s]===e){const[e,s]=process.argv.slice(2);switch(e){case"generate":n.writeFileSync("update-manifest.json",JSON.stringify(u(),null,2)),console.log("已生成 update-manifest.json");break;case"check":f().then(e=>{if(!e.length)return console.log("当前已是最新");console.log("需要更新的文件列表:"),e.forEach(e=>console.log(`- ${e.file}`))});break;case"update":d();break;case"set-url":g(s);break;case"config":h();break;default:console.log("可用命令:\n  generate    生成清单\n  check       检查更新\n  update      执行更新\n  set-url     设置远程清单地址\n  config      显示当前配置")}}e.exports={generateManifest:u,checkUpdate:f,runUpdate:d,setManifestUrl:g,showConfig:h}},982:e=>{"use strict";e.exports=require("crypto")}},s={};function t(n){var o=s[n];if(void 0!==o)return o.exports;var r=s[n]={id:n,loaded:!1,exports:{}};return e[n](r,r.exports,t),r.loaded=!0,r.exports}t.c=s,t.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var n=t(t.s=952);module.exports=n})();