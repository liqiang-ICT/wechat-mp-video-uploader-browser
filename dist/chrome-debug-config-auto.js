(()=>{function e(e){const t=document.getElementById("chrome-debug-config-info");t?(t.textContent+="\n"+e,console.log("[配置自动操作]",e)):console.log("[配置自动操作]",e)}function t(e){return new Promise(t=>setTimeout(t,e))}function o(e){for(const t of e){const e=document.querySelector(t);if(e)return console.log(`使用选择器成功找到元素: ${t}`),e}return console.warn(`尝试了 ${e.length} 种选择器都未能找到元素`),null}function i(e,t="元素"){if(!e)return console.error(`${t}不存在，无法点击`),!1;try{return e.click(),console.log(`成功点击 ${t}`),!0}catch(e){return console.error(`点击 ${t} 时出错:`,e),!1}}async function n(i,n=10,a=300){let r=0;for(;r<n;){const c=o(i);if(c)return c;r++,e(`等待元素出现，第${r}/${n}次尝试`),await t(a)}return console.error(`等待元素超时，未找到: ${i.join(", ")}`),null}async function a(){try{e("开始自动配置视频发布设置...");const o=await n(["#title"]);let a="";o?(a=o.value.trim(),e(a?`标题框内容: ${a}`:"标题框为空，无需复制")):e("未找到标题框，无法复制标题内容"),await c("0");const d=await n(["#title"]);d?(d.value=a,e(`已将标题内容复制到新文章: ${a}`)):e("未找到描述框，无法复制标题内容"),await s(),await c("5"),await async function(o){e(`正在根据标题选择视频: ${o}`);const a=[".more-video__list.more-video__list_double"];let r=await n(a);if(r){let c=r.querySelectorAll(".more-video__item");for(;0===c.length;)e("视频列表为空，等待加载..."),await t(1e3),c=r.querySelectorAll(".more-video__item");let l=!1;for(;!l;){e(`视频列表中找到 ${c.length} 个视频`);for(const t of c){const a=t.querySelector(".more-video__item-title").textContent.trim();if(a.includes(o)){i(t.querySelector(".more-video__item-content"),`标题匹配视频: ${a}`),e(`已选择标题匹配视频: ${a}`);const o=["div.video-select-dialog > div.weui-desktop-dialog__wrp > div > div.weui-desktop-dialog__ft > div > div:nth-child(3) > button"],r=await n(o);r?(i(r,"确认选择视频"),e("已点击确认选择视频")):e("未找到确认按钮，无法点击"),l=!0;break}}if(l){e("找到匹配标题的视频");break}{e("未找到匹配标题的视频，点击下一页");const o=["div.more-video__lib > div.weui-desktop-pagination > span.weui-desktop-pagination__nav"],l=await n(o);if(!l){e("未找到分页导航");break}const s=l.querySelectorAll("a");if(!(s.length>0)){e("未找到分页按钮");break}{const o=s[s.length-1];if("下一页"!==o.textContent.trim()){e("未找到下一页按钮，可能已到达最后一页");break}if(i(o,"下一页按钮"),r=await n(a),!r){e("等待视频列表加载失败");break}for(;!r.checkVisibility();)e("视频列表隐藏，等待加载..."),await t(500);for(c=r.querySelectorAll(".more-video__item");0===c.length;)e("视频列表为空，等待加载..."),await t(500),c=r.querySelectorAll(".more-video__item")}}}}else e("未找到视频列表，无法根据标题选择视频")}(a),await r(),await l(),await s(),e("视频发布配置已自动完成！"),window._configAutoCompleted=!0}catch(t){console.error("自动配置过程中出错:",t),e(`配置过程出错: ${t.message}`)}}async function r(){e("正在处理留言配置...");const t=await n([".setting-group__switch-tips_default"]);if(t){i(t,"留言配置按钮");const o=[".interaction-dialog__footer .weui-desktop-btn_primary"],a=await n(o);a&&(i(a,"留言配置确认按钮"),e("留言配置已成功开启"))}}async function c(t="0"){e(`正在点击"${t}"替换按钮...`);const o=[`li[data-type="${t}"]`],a=[".js_replace_pop.pos_left_top .btn.btn_primary.jsPopoverBt"],r=await n([".weui-desktop-icon-btn__exchange"]);r?(i(r,'"替换"按钮'),e('已点击"替换"按钮')):e('未找到"替换"按钮，无法点击');const c=await n(o);if(c){i(c,`"${t}"替换按钮`),e(`已点击"${t}"替换按钮`);const o=await n(a);o?(i(o,'"确认"按钮'),e('已点击"确认"按钮')):e('未找到"确认"按钮，无法点击')}else e(`未找到"${t}"替换按钮，无法点击`)}async function l(){e("正在处理内容声明...");const t=await n(["#js_import_to_finder .allow_click_opr"]);t?(i(t,"打开”发表后转为视频号视频“配置"),e("已打开”发表后转为视频号视频“配置")):e("未找到打开”发表后转为视频号视频“配置，无法点击");const o=await n(["#import_finder_0"]);o?(i(o,"关闭”发表后转为视频号视频“配置"),e("已关闭”发表后转为视频号视频“配置")):e("未找到关闭”发表后转为视频号视频“配置，无法点击");const a=await n([".allow_click_opr.js_claim_source_desc"]);if(a)i(a,"内容声明面板"),e("已点击内容声明面板");else{e("未找到内容声明面板，无法点击");if(!window.confirm("未找到内容声明面板，是否继续？"))return void e("用户选择不继续，跳过内容声明处理")}const r=await n(['input[type="radio"][class="weui-desktop-form__radio"][value="1"]']);if(r)i(r,"内容来自AI选项"),e('内容声明已设置为"内容来自AI"');else{e('未找到"内容来自AI"选项，无法点击');if(!window.confirm('未找到"内容来自AI"选项，是否继续？'))return void e("用户选择不继续，跳过内容声明处理")}const c=await n(["div.claim-source-dialog .weui-desktop-btn_primary"]);if(c)i(c,"内容声明确认按钮"),e("已点击内容声明确认按钮");else{e("未找到内容声明确认按钮，无法点击");if(!window.confirm("未找到内容声明确认按钮，是否继续？"))return void e("用户选择不继续，跳过内容声明处理")}}async function s(){e("正在保存配置...");const o=await n(["#js_submit button"]);if(o){for(i(o,"保存按钮"),e("已点击保存按钮"),e("等待保存操作完成..."),await t(1e3);o.disabled;)await t(1e3),e("保存ing...");e("保存操作已完成")}}async function d(){!function(){const e=window.location.href;return e.includes("mp.weixin.qq.com")&&e.includes("cgi-bin/appmsg")&&e.includes("t=media/appmsg_edit_v2")&&e.includes("action=edit")}()?console.log("当前页面不是视频配置页面，脚本将不会执行"):(!function(){if(document.getElementById("chrome-debug-config-info"))return;const e=document.createElement("div");e.id="chrome-debug-config-info",e.style.position="fixed",e.style.top="10px",e.style.right="10px",e.style.zIndex="10000",e.style.backgroundColor="#f5f5f5",e.style.border="2px solid #4CAF50",e.style.borderRadius="4px",e.style.padding="10px",e.style.minWidth="300px",e.style.maxHeight="400px",e.style.overflow="auto",e.style.fontSize="12px",e.style.whiteSpace="pre-wrap",e.style.fontFamily="monospace",e.style.color="#333",e.textContent="视频配置自动操作脚本已加载，准备开始自动配置...",document.body.appendChild(e)}(),window.chromeDebugConfigAutoInjected=!0,await a())}console.log("微信公众号视频配置自动操作脚本已加载"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d(),window.WechatVideoAutoConfig={init:d,autoConfigureVideoPublish:a,handleCommentConfig:r,handleContentDeclaration:l,handleSave:s},module.exports={}})();