!function(){function t(t){console.log("[草稿箱记录批量管理]",t);const e=document.getElementById("card-debug");e&&(e.textContent+=(e.textContent?"\n":"")+t)}function e(){try{const e=window.wx&&wx.cgiData,n=e&&Array.isArray(e.item)?e.item:null;if(!n)throw new Error("wx.cgiData.item 不存在");return t(`从wx.cgiData.item收集未删除草稿箱记录 ${n.length} 条`),n}catch(e){return t(`收集失败：${e.message}`),[]}}async function n(){const n=e();if(!n.length)return void alert("未找到未删除的草稿箱记录");if(t(`确认删除 ${n.length} 条草稿箱记录`),!window.confirm(`确认删除 ${n.length} 条草稿箱记录吗？`))return void t("用户取消了删除操作");const i=window.location.href,a=new URL(i).searchParams.get("token");if(!a)return void alert("未找到token，请先登录微信公众平台");const r=document.getElementById("article-batch-delete-button");if(!r)return void alert("未找到批量删除按钮");r.textContent=`批量删除(0/${n.length})`,r.disabled=!0;let c=0;for(const e of n)try{await o(e.app_id,a),t(`删除成功：${e.title} -> app_id: ${e.app_id}`),c++,r.textContent=`批量删除(成功${c}/${n.length})`}catch(n){t(`删除失败：${e.title} -> ${n.message}`)}t(`已成功删除 ${c} 条草稿箱记录`),r.textContent="批量删除",r.disabled=!1,window.location.reload()}async function o(t,e,n){try{const n=`AppMsgId=${t}&token=${e}&lang=zh_CN&f=json&ajax=1`,o=await fetch("https://mp.weixin.qq.com/cgi-bin/operate_appmsg?sub=del&t=ajax-response",{body:n,method:"POST"}),i=await o.json();return console.log(`处理 ID: ${t} 的结果：`),console.log(i),i}catch(e){throw console.error(`处理 ID: ${t} 时发生错误：`),console.error(e),e}}function i(){t("初始化文章发表记录批量管理脚本..."),function(){const e=document.querySelector("#searchDiv");if(!e)return void t("未找到#searchDiv容器，无法注入主按钮");if(document.getElementById("article-batch-delete-button"))return;const o=document.createElement("button");o.id="article-batch-delete-button",o.textContent="批量删除",o.classList.add("weui-desktop-btn"),o.classList.add("weui-desktop-btn_primary"),o.style.marginLeft="10px",o.addEventListener("click",n),e.parentElement.appendChild(o),t("主按钮“批量删除”已注入")}()}window.CardBatchManagerInitialized?console.log("草稿箱记录批量管理脚本已初始化，跳过"):(window.CardBatchManagerInitialized=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i(),window.ArticlePublishRecordManager={init:i,collectPublishedArticles:e})}(),module.exports={};